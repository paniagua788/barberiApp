<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="./static/output.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
      integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <title>BarberiApp</title>
    <script>
      // Función para obtener la fecha en formato YYYY-MM-DD
      function getFormattedDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const day = String(date.getDate()).padStart(2, "0");
        return `${year}-${month}-${day}`;
      }

      // Función para establecer el rango de fechas permitido
      function setDateRange() {
        const today = new Date();
        const maxDate = new Date();
        maxDate.setDate(today.getDate() + 6);

        const fechaInput = document.getElementById("fecha");
        fechaInput.min = getFormattedDate(today);
        fechaInput.max = getFormattedDate(maxDate);

        // Validar la fecha seleccionada cuando el usuario intente cambiarla
        fechaInput.addEventListener("input", function () {
          const selectedDate = new Date(fechaInput.value);
          if (selectedDate < today || selectedDate > maxDate) {
            fechaInput.setCustomValidity(
              "Por favor, selecciona una fecha dentro de los próximos 6 días."
            );
          } else {
            fechaInput.setCustomValidity("");
          }
        });
      }

      // Función para actualizar los horarios disponibles
      async function updateAvailableTimes() {
        const date = document.getElementById("fecha").value;
        const response = await fetch(`/available_times?date=${date}`);
        const times = await response.json();

        const timeSelect = document.getElementById("hora");
        timeSelect.innerHTML = "";
        times.forEach((time) => {
          const option = document.createElement("option");
          option.value = time;
          option.text = time;
          timeSelect.appendChild(option);
        });
      }

      // Establecer el rango de fechas cuando se cargue la página
      window.onload = function () {
        setDateRange();
      };
    </script>
  </head>

  <body>
    <header class="bg-white shadow-lg h-24 flex justify-between md:flex">
      <a
        href=""
        class="flex-shrink-0 flex items-center justify-center px-4 lg:px-6 xl:px-8"
      >
        <img class="size-40" src="../static/barber-logo.png" alt="" />
      </a>
      <div class="mt-6 lg:mb-0 mb-6">
        <button
          class="bg-white text-lightBlue-600 shadow-lg font-normal h-10 w-10 items-center justify-center align-center rounded-full outline-none focus:outline-none mr-2"
          type="button"
          onclick="window.location.href=''"
        >
          <i class="fa-brands fa-instagram"></i>
        </button>
        <button
          class="bg-white text-blueGray-800 shadow-lg font-normal h-10 w-10 items-center justify-center align-center rounded-full outline-none focus:outline-none mr-2"
          type="button"
          onclick="window.location.href=''"
        >
          <i class="fab fa-whatsapp"></i>
        </button>
      </div>
    </header>
    <!-- FORM SECTION -->
    <section class="flex justify-center mt-10 m-5">
      <form class="w-full max-w-lg" action="/agendar" method="POST">
        <div class="flex flex-wrap -mx-3 mb-6">
          <div class="w-full px-3">
            <label
              class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2"
              for="nombre"
            >
              Nombre
            </label>
            <p class="text-gray-600 text-xs italic">
              A nombre de quién se hará la reserva
            </p>
            <input
              class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500"
              id="nombre"
              name="nombre"
              type="text"
              required
            />
          </div>
        </div>
        <div class="flex flex-wrap -mx-3 mb-6">
          <div class="w-full px-3">
            <label
              class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2"
              for="servicio"
            >
              Servicio
            </label>
            <select
              id="servicio"
              name="servicio"
              class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500"
              required
            >
              <option value="">Elija un servicio</option>
              <option value="Pelo">Pelo</option>
              <option value="Barba">Barba</option>
              <option value="Pelo y Barba">Pelo y Barba</option>
            </select>
          </div>
        </div>
        <div class="flex flex-wrap -mx-3 mb-6">
          <div class="w-full px-3">
            <label
              class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2"
              for="fecha"
            >
              Fecha
            </label>
            <input
              class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500"
              onchange="updateAvailableTimes()"
              id="fecha"
              name="fecha"
              type="date"
              required
            />
          </div>
        </div>
        <div class="flex flex-wrap -mx-3 mb-6">
          <div class="w-full px-3">
            <label
              class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2"
              for="hora"
            >
              Hora
            </label>
            <p class="text-gray-600 text-xs italic">
              Sólo se listan los horarios disponibles
            </p>
            <select
              id="hora"
              name="hora"
              class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500"
              required
            ></select>
          </div>
        </div>
        <div class="flex flex-wrap -mx-3 mb-6">
          <div class="w-full px-3">
            <label
              class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2"
              for="contacto"
            >
              Telefono
            </label>
            <input
              class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500"
              id="contacto"
              name="contacto"
              type="number"
              required
            />
          </div>
        </div>
        <div class="md:flex md:items-center">
          <div class="md:w-1/3">
            <button
              class="shadow bg-red-900 hover:bg-red-800 focus:shadow-outline focus:outline-none text-white font-bold py-2 px-4 rounded"
              type="submit"
            >
              Agendar
            </button>
          </div>
          <div class="md:w-2/3"></div>
        </div>
      </form>
    </section>
  </body>
</html>
